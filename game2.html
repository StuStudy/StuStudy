<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>

    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #222;
            margin: 0;
            font-family: Arial, sans-serif;
            color: white;
        }

        canvas {
            border: 1px solid white;
        }

        .game-info {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 18px;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
            font-weight: bold;
            display: none;
        }
    </style>
</head>

<body>

<canvas id="gameCanvas" width="400" height="400"></canvas>

<div class="game-info">
    <div id="currentScore">Score: 0</div>
    <div id="highScore">High Score: 0</div>
</div>

<div id="gameOver" class="game-over">Game Over! Press R to Restart</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const scale = 20;
    const rows = canvas.height / scale;
    const columns = canvas.width / scale;

    let snake;
    let food;
    let gameOver = false;
    let currentScore = 0;

    let highScore = localStorage.getItem("highScore")
        ? parseInt(localStorage.getItem("highScore"))
        : 0;

    const currentScoreDisplay = document.getElementById("currentScore");
    const highScoreDisplay = document.getElementById("highScore");
    const gameOverDisplay = document.getElementById("gameOver");

    // Direction control
    let nextDirection = "right";
    let directionLocked = false;

    // Images
    const snakeHeadImg = new Image();
    const snakeBodyImg = new Image();
    snakeHeadImg.src = "snakeHead.png";
    snakeBodyImg.src = "snakeBody.png";

    (function setup() {
        snake = new Snake();
        food = new Food();
        updateScore();
        window.setInterval(gameLoop, 100);
        document.addEventListener("keydown", changeDirection);
    })();

    function gameLoop() {
        if (gameOver) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "green";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Apply only ONE direction per tick
        snake.setDirection(nextDirection);
        directionLocked = false;

        snake.update();
        snake.draw();
        food.draw();

        checkCollision();
        updateScore();
    }

    function checkCollision() {
        // Wall collision
        if (
            snake.x < 0 ||
            snake.y < 0 ||
            snake.x >= canvas.width ||
            snake.y >= canvas.height
        ) {
            endGame();
        }

        // Self collision
        for (let part of snake.body) {
            if (snake.x === part.x && snake.y === part.y) {
                endGame();
            }
        }

        // Food collision
        if (snake.x === food.x && snake.y === food.y) {
            snake.grow();
            food.randomize();
            currentScore++;

            if (currentScore > highScore) {
                highScore = currentScore;
                localStorage.setItem("highScore", highScore);
            }
        }
    }

    function changeDirection(event) {
        let newDirection = null;

        if (event.keyCode === 37 || event.keyCode === 65) newDirection = "left";
        if (event.keyCode === 38 || event.keyCode === 87) newDirection = "up";
        if (event.keyCode === 39 || event.keyCode === 68) newDirection = "right";
        if (event.keyCode === 40 || event.keyCode === 83) newDirection = "down";

        if (event.keyCode === 82 && gameOver) {
            restartGame();
            return;
        }

        if (!newDirection || directionLocked) return;

        // Prevent reversing direction
        if (
            (snake.direction === "left" && newDirection === "right") ||
            (snake.direction === "right" && newDirection === "left") ||
            (snake.direction === "up" && newDirection === "down") ||
            (snake.direction === "down" && newDirection === "up")
        ) {
            return;
        }

        nextDirection = newDirection;
        directionLocked = true;
    }

    function restartGame() {
        gameOver = false;
        currentScore = 0;
        snake = new Snake();
        food = new Food();
        nextDirection = "right";
        gameOverDisplay.style.display = "none";
    }

    function endGame() {
        gameOver = true;
        gameOverDisplay.style.display = "block";
    }

    function updateScore() {
        currentScoreDisplay.textContent = `Score: ${currentScore}`;
        highScoreDisplay.textContent = `High Score: ${highScore}`;
    }

    function isFoodOnSnake(x, y) {
        if (snake.x === x && snake.y === y) return true;
        return snake.body.some(part => part.x === x && part.y === y);
    }

    function Snake() {
        this.x = 100;
        this.y = 100;
        this.direction = "right";
        this.body = [];

        this.update = function () {
            if (this.body.length) {
                for (let i = 0; i < this.body.length - 1; i++) {
                    this.body[i] = this.body[i + 1];
                }
                this.body[this.body.length - 1] = { x: this.x, y: this.y };
            }

            if (this.direction === "left") this.x -= scale;
            if (this.direction === "up") this.y -= scale;
            if (this.direction === "right") this.x += scale;
            if (this.direction === "down") this.y += scale;
        };

        this.grow = function () {
            this.body.push({});
        };

        this.setDirection = function (dir) {
            this.direction = dir;
        };

        this.draw = function () {
            ctx.drawImage(snakeHeadImg, this.x, this.y, scale, scale);
            for (let part of this.body) {
                ctx.drawImage(snakeBodyImg, part.x, part.y, scale, scale);
            }
        };
    }

    function Food() {
        this.x = 0;
        this.y = 0;

        this.randomize = function () {
            let x, y;
            do {
                x = Math.floor(Math.random() * rows) * scale;
                y = Math.floor(Math.random() * columns) * scale;
            } while (isFoodOnSnake(x, y));

            this.x = x;
            this.y = y;
        };

        this.draw = function () {
            ctx.fillStyle = "red";
            ctx.fillRect(this.x, this.y, scale, scale);
        };

        this.randomize();
    }
</script>

</body>
</html>

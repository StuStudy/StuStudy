<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Relaxing Music</title>
<link rel="icon" type="image/png" href="MUSIC.png">
<meta http-equiv="Content-Security-Policy" content="frame-ancestors 'none';">
<meta http-equiv="X-Frame-Options" content="DENY">

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    min-height: 100vh;
    padding: 20px;
    overflow: hidden;
    background: linear-gradient(-45deg, #2196f3, #00bcd4, #1a237e, #0d47a1);
    background-size: 400% 400%;
    animation: gradientMove 20s ease infinite;
    color: white;
  }
  body.pink-theme {
    background: linear-gradient(-45deg, #ff4081, #f50057, #ec407a, #f06292);
    background-size: 400% 400%;
    animation: gradientMove 20s ease infinite;
    color: white;
  }
  @keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  .color-button {
    position: fixed;
    top: 10px;
    height: 40px;
    cursor: pointer;
    z-index: 1000;
    padding: 0 12px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    color: white;
    font-weight: bold;
  }
  #blueButton { background-color: #1976d2; right: 70px; }
  #pinkButton { background-color: #e91e63; right: 10px; }
  h1, h3 { text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
  #uploadLabel {
    display: inline-block;
    margin: 20px 0 10px;
    padding: 10px 20px;
    background-color: rgba(255,255,255,0.1);
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s;
  }
  #uploadLabel:hover {
    background-color: rgba(255,255,255,0.3);
  }
  input[type="file"] {
    display: none;
  }
  .media-wrapper {
    position: relative;
    margin-bottom: 20px;
    max-width: 400px;
  }
  audio, video {
    width: 100%;
    display: block;
  }
  .delete-button {
    position: absolute;
    top: 5px;
    right: 5px;
    background: #ff1744;
    border: none;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    opacity: 0.8;
    transition: opacity 0.3s;
  }
  .delete-button:hover {
    opacity: 1;
  }
  #infoBox {
    position: fixed;
    bottom: 10px;
    left: 10px;
    font-size: 14px;
    color: lime;
    text-shadow: 1px 1px 2px black;
    max-width: 320px;
    z-index: 1000;
  }
</style>
</head>
<body>

<h1 style="color:lime;">Choose files and listen to music your music must be 35 minutes maximum long!</h1>
<hr>
<h3 style="color:lime;">Upload your music or video files to listen!</h3>

<label for="fileUpload" id="uploadLabel">Choose Music/Video File(s)</label>
<input id="fileUpload" type="file" multiple accept="audio/*,video/*" />

<div id="playerContainer"></div>

<div id="infoBox">
  Your music must be 50 MB maximum or it will not work<br>
</div>

<button id="blueButton" class="color-button">Blue</button>
<button id="pinkButton" class="color-button">Pink</button>

<script>
  const body = document.body;
  const blueButton = document.getElementById("blueButton");
  const pinkButton = document.getElementById("pinkButton");
  const fileUpload = document.getElementById("fileUpload");
  const playerContainer = document.getElementById("playerContainer");
  const MAX_SIZE = 50 * 1024 * 1024; // 50 MB

  let db;
  const request = indexedDB.open("MusicDB", 1);

  request.onerror = (event) => {
    console.error("IndexedDB error:", event.target.errorCode);
  };

  request.onupgradeneeded = (event) => {
    db = event.target.result;
    if (!db.objectStoreNames.contains("files")) {
      db.createObjectStore("files", { keyPath: "id", autoIncrement: true });
    }
  };

  request.onsuccess = (event) => {
    db = event.target.result;
    loadFilesFromDB();
  };

  // Load all files from DB and create players with delete buttons
  function loadFilesFromDB() {
    playerContainer.innerHTML = "";
    const transaction = db.transaction(["files"], "readonly");
    const objectStore = transaction.objectStore("files");
    const requestAll = objectStore.getAll();

    requestAll.onsuccess = (e) => {
      const files = e.target.result;
      files.forEach(fileRecord => {
        createPlayer(fileRecord.id, URL.createObjectURL(fileRecord.file), fileRecord.file.type);
      });
    };
  }

  // Create player wrapper with media and delete button
  function createPlayer(id, src, type) {
    const wrapper = document.createElement("div");
    wrapper.className = "media-wrapper";
    wrapper.dataset.id = id;

    let mediaElem;
    if (type.startsWith("video")) {
      mediaElem = document.createElement("video");
    } else {
      mediaElem = document.createElement("audio");
    }
    mediaElem.controls = true;
    mediaElem.src = src;

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Delete";
    deleteBtn.className = "delete-button";
    deleteBtn.title = "Delete this file";

    deleteBtn.onclick = () => {
      deleteFile(id, wrapper);
    };

    wrapper.appendChild(mediaElem);
    wrapper.appendChild(deleteBtn);
    playerContainer.appendChild(wrapper);
  }

  // Delete file from IndexedDB and remove from DOM
  function deleteFile(id, wrapper) {
    const transaction = db.transaction(["files"], "readwrite");
    const objectStore = transaction.objectStore("files");
    const requestDelete = objectStore.delete(id);

    requestDelete.onsuccess = () => {
      wrapper.remove();
    };

    requestDelete.onerror = () => {
      alert("Error deleting the file.");
    };
  }

  // Save file to IndexedDB
  function saveFileToDB(file) {
    const transaction = db.transaction(["files"], "readwrite");
    const objectStore = transaction.objectStore("files");
    objectStore.add({ file });
  }

  // Handle file input
  fileUpload.addEventListener("change", () => {
    const files = Array.from(fileUpload.files);

    files.forEach(file => {
      if (file.size > MAX_SIZE) {
        alert(`File "${file.name}" is larger than 50 MB and will not be saved.`);
        return;
      }
      createPlayer(null, URL.createObjectURL(file), file.type);
      saveFileToDB(file);
    });

    fileUpload.value = ""; // reset input
  });

  // Theme buttons
  window.onload = function () {
    const savedTheme = localStorage.getItem("selectedTheme");
    if (savedTheme) {
      body.classList.remove("blue-theme", "pink-theme");
      body.classList.add(savedTheme);
    } else {
      body.classList.add("blue-theme");
    }
  };

  blueButton.onclick = function () {
    body.classList.remove("pink-theme");
    body.classList.add("blue-theme");
    localStorage.setItem("selectedTheme", "blue-theme");
  };

  pinkButton.onclick = function () {
    body.classList.remove("blue-theme");
    body.classList.add("pink-theme");
    localStorage.setItem("selectedTheme", "pink-theme");
  };
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multi Timer & Stopwatch with Persistence</title>
  <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'none';">
  <meta http-equiv="X-Frame-Options" content="DENY">

  <style>
    /* Background & theme */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      min-height: 100vh;
      padding: 20px;
      transition: background 0.5s ease;
    }
    body.blue-theme {
      background: linear-gradient(-45deg, #2196f3, #00bcd4, #1a237e, #0d47a1);
      background-size: 400% 400%;
      animation: gradientMove 20s ease infinite;
      color: white;
    }
    body.pink-theme {
      background: linear-gradient(-45deg, #ff4081, #f50057, #ec407a, #f06292);
      background-size: 400% 400%;
      animation: gradientMove 20s ease infinite;
      color: white;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Theme buttons */
    .color-button {
      position: fixed;
      top: 10px;
      height: 40px;
      cursor: pointer;
      z-index: 1000;
      padding: 0 12px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      color: white;
      font-weight: bold;
      user-select: none;
    }
    #blueButton { right: 90px; background-color: #1976d2; }
    #pinkButton { right: 20px; background-color: #e91e63; }

    /* Container */
    .container {
      max-width: 900px;
      margin: 70px auto 40px;
    }

    h1 {
      text-align: center;
      margin-bottom: 40px;
      text-shadow: 1px 1px 5px rgba(0,0,0,0.4);
    }

    /* Timers grid */
    .timers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(220px,1fr));
      gap: 20px;
    }

    /* Timer card */
    .timer-card {
      background: rgba(255 255 255 / 0.15);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
    }

    .timer-label {
      font-size: 22px;
      margin-bottom: 12px;
    }

    .time-display {
      font-size: 36px;
      margin-bottom: 20px;
      font-family: 'Courier New', Courier, monospace;
      letter-spacing: 2px;
    }

    .buttons {
      display: flex;
      gap: 10px;
    }

    button {
      cursor: pointer;
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      font-size: 14px;
      font-weight: 600;
      background: rgba(255 255 255 / 0.9);
      color: #222;
      transition: background-color 0.2s ease;
      user-select: none;
    }
    button:hover {
      background: rgba(255 255 255 / 1);
    }

    /* Stopwatch special styling */
    #stopwatch .timer-label {
      font-weight: bold;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .timers-grid {
        grid-template-columns: repeat(auto-fill,minmax(160px,1fr));
      }
      button {
        padding: 6px 10px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>

  <button id="blueButton" class="color-button">Blue</button>
  <button id="pinkButton" class="color-button">Pink</button>

  <div class="container">
    <h1>Multi Timers & Stopwatch</h1>

    <div class="timers-grid" id="timersGrid">
      <!-- Timers injected by JS -->
    </div>

    <!-- Stopwatch -->
    <div class="timer-card" id="stopwatch">
      <div class="timer-label">Stopwatch</div>
      <div class="time-display" id="stopwatchDisplay">00:00:00</div>
      <div class="buttons">
        <button id="swStartPause">Start</button>
        <button id="swReset" disabled>Reset</button>
      </div>
    </div>

    <!-- Custom Timer -->
    <div class="timer-card" id="customTimer">
      <div class="timer-label">Custom Timer</div>
      <input type="number" id="customTimeInput" placeholder="Enter time in minutes" min="1" />
      <div class="time-display" id="customTimerDisplay">00:00</div>
      <div class="buttons">
        <button id="customTimerStartPause">Start</button>
        <button id="customTimerReset" disabled>Reset</button>
      </div>
    </div>

  </div>

  <audio id="alarmSound" src="alarm.mp3" preload="auto"></audio>

  <script>
    // --- Theme handling ---
    const body = document.body;
    const blueButton = document.getElementById("blueButton");
    const pinkButton = document.getElementById("pinkButton");

    // Apply the selected theme
    function applyTheme(theme) {
      body.classList.remove("blue-theme", "pink-theme");
      if (theme) body.classList.add(theme);
      localStorage.setItem("selectedTheme", theme);
    }

    // Click event for Blue button
    blueButton.onclick = () => applyTheme("blue-theme");

    // Click event for Pink button
    pinkButton.onclick = () => applyTheme("pink-theme");

    // Load saved theme or default to blue on page load
    window.onload = () => {
      const savedTheme = localStorage.getItem("selectedTheme") || "blue-theme";
      applyTheme(savedTheme);

      // Load saved custom time and timers state
      const savedCustomTime = localStorage.getItem("customTime");
      if (savedCustomTime) {
        document.getElementById("customTimeInput").value = savedCustomTime;
      }

      // Load grid timers state
      const savedTimersState = JSON.parse(localStorage.getItem("timersState")) || [];
      savedTimersState.forEach((state, index) => {
        timers[index].remaining = state.remaining;
        timers[index].running = state.running;
        timers[index].display.textContent = formatTime(state.remaining);
        if (state.running) {
          timers[index].btnStartPause.textContent = 'Pause';
        }
      });

      // Load saved stopwatch state
      const savedStopwatch = JSON.parse(localStorage.getItem("stopwatchState")) || { seconds: 0, running: false };
      stopwatchTime = savedStopwatch.seconds;
      stopwatchRunning = savedStopwatch.running;
      swDisplay.textContent = formatStopwatch(stopwatchTime);
      if (stopwatchRunning) {
        swStartPause.textContent = "Pause";
      }
    };

    // --- Timer and Stopwatch logic ---
    const timersGrid = document.getElementById('timersGrid');
    const alarmSound = document.getElementById('alarmSound');

    const timerMinutes = [5,10,15,30,45,60,75,90,105,120, 180, 280]; 
    const timers = [];

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60).toString().padStart(2, '0');
      const s = (seconds % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    timerMinutes.forEach((mins, index) => {
      const card = document.createElement('div');
      card.className = 'timer-card';

      const label = document.createElement('div');
      label.className = 'timer-label';
      label.textContent = `${mins} Minute Timer`;

      const display = document.createElement('div');
      display.className = 'time-display';
      display.textContent = formatTime(mins * 60);

      const btnStartPause = document.createElement('button');
      btnStartPause.textContent = 'Start';

      const btnReset = document.createElement('button');
      btnReset.textContent = 'Reset';
      btnReset.disabled = true;

      const btnsDiv = document.createElement('div');
      btnsDiv.className = 'buttons';
      btnsDiv.append(btnStartPause, btnReset);

      card.append(label, display, btnsDiv);
      timersGrid.appendChild(card);

      timers.push({
        id: index,
        duration: mins * 60,
        remaining: mins * 60,
        intervalId: null,
        running: false,
        display,
        btnStartPause,
        btnReset
      });

      btnStartPause.onclick = () => {
        const timer = timers[index];
        if (!timer.running && timer.remaining > 0) {
          timer.intervalId = setInterval(() => {
            timer.remaining--;
            timer.display.textContent = formatTime(timer.remaining);
            if (timer.remaining <= 0) {
              clearInterval(timer.intervalId);
              timer.running = false;
              timer.btnStartPause.textContent = "Start";
              timer.btnReset.disabled = false;
              alarmSound.play();
            }
            saveTimersState();
          }, 1000);
          timer.running = true;
          btnStartPause.textContent = 'Pause';
          btnReset.disabled = false;
        } else if (timer.running) {
          clearInterval(timer.intervalId);
          timer.running = false;
          btnStartPause.textContent = 'Start';
        }
      };

      btnReset.onclick = () => {
        const timer = timers[index];
        if (timer.intervalId) {
          clearInterval(timer.intervalId);
          timer.intervalId = null;
        }
        timer.remaining = timer.duration;
        timer.display.textContent = formatTime(timer.remaining);
        timer.running = false;
        btnStartPause.textContent = 'Start';
        btnReset.disabled = true;
        saveTimersState();
      };
    });

    // Save grid timers state to localStorage
    function saveTimersState() {
      const timersState = timers.map(timer => ({
        remaining: timer.remaining,
        running: timer.running
      }));
      localStorage.setItem("timersState", JSON.stringify(timersState));
    }

    // Custom Timer logic
    const customTimeInput = document.getElementById('customTimeInput');
    const customTimerDisplay = document.getElementById('customTimerDisplay');
    const customTimerStartPause = document.getElementById('customTimerStartPause');
    const customTimerReset = document.getElementById('customTimerReset');

    let customTimerRunning = false;
    let customTimerTime = 0;
    let customTimerInterval = null;

    customTimeInput.oninput = () => {
      // Save custom time input to localStorage
      localStorage.setItem("customTime", customTimeInput.value);
    };

    customTimerStartPause.onclick = () => {
      const customTime = parseInt(customTimeInput.value, 10);
      if (isNaN(customTime) || customTime <= 0) {
        alert("Please enter a valid number of minutes.");
        return;
      }

      if (!customTimerRunning) {
        customTimerTime = customTimerTime || customTime * 60;
        customTimerDisplay.textContent = formatTime(customTimerTime);

        customTimerInterval = setInterval(() => {
          customTimerTime--;
          customTimerDisplay.textContent = formatTime(customTimerTime);
          if (customTimerTime <= 0) {
            clearInterval(customTimerInterval);
            customTimerRunning = false;
            customTimerStartPause.textContent = "Start";
            customTimerReset.disabled = false;
            alarmSound.play();
          }
        }, 1000);
        customTimerRunning = true;
        customTimerStartPause.textContent = 'Pause';
        customTimerReset.disabled = false;
      } else {
        clearInterval(customTimerInterval);
        customTimerRunning = false;
        customTimerStartPause.textContent = 'Resume';
      }
    };

    customTimerReset.onclick = () => {
      clearInterval(customTimerInterval);
      customTimerRunning = false;
      customTimerTime = 0;
      customTimerDisplay.textContent = "00:00";
      customTimerStartPause.textContent = "Start";
      customTimerReset.disabled = true;
      // Clear saved custom timer state
      localStorage.removeItem("customTimer");
    };

    // --- Stopwatch logic ---
    const swDisplay = document.getElementById('stopwatchDisplay');
    const swStartPause = document.getElementById('swStartPause');
    const swReset = document.getElementById('swReset');

    let stopwatchRunning = false;
    let stopwatchTime = 0;
    let swInterval = null;

    function formatStopwatch(seconds) {
      const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
      const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
      const s = (seconds % 60).toString().padStart(2, '0');
      return `${h}:${m}:${s}`;
    }

    swStartPause.onclick = () => {
      if (!stopwatchRunning) {
        swInterval = setInterval(() => {
          stopwatchTime++;
          swDisplay.textContent = formatStopwatch(stopwatchTime);
          saveStopwatchState();
        }, 1000);
        stopwatchRunning = true;
        swStartPause.textContent = 'Pause';
        swReset.disabled = false;
      } else {
        clearInterval(swInterval);
        stopwatchRunning = false;
        swStartPause.textContent = 'Resume';
      }
    };

    swReset.onclick = () => {
      clearInterval(swInterval);
      stopwatchTime = 0;
      stopwatchRunning = false;
      swDisplay.textContent = '00:00:00';
      swStartPause.textContent = 'Start';
      swReset.disabled = true;
      saveStopwatchState();
    };

    // Save stopwatch state to localStorage
    function saveStopwatchState() {
      const stopwatchState = { seconds: stopwatchTime, running: stopwatchRunning };
      localStorage.setItem("stopwatchState", JSON.stringify(stopwatchState));
    }
  </script>

</body>
</html>
